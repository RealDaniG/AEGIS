<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metatron's Cube ¬∑ Unified Consciousness & AI Chat</title>
    <link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 50%, #0a0a1a 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.3);
        }
        
        h1 {
            color: #c084fc;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(192, 132, 252, 0.5);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #a78bfa;
            font-size: 1.1em;
            font-style: italic;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(192, 132, 252, 0.3);
            border-radius: 5px;
            cursor: pointer;
            color: #a78bfa;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: rgba(192, 132, 252, 0.2);
        }
        
        .tab.active {
            background: #c084fc;
            color: #000;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: #c084fc;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid rgba(192, 132, 252, 0.3);
            padding-bottom: 10px;
        }
        
        .panel h3 {
            color: #a78bfa;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 12px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 5px;
        }
        
        .metric-label {
            color: #a78bfa;
            font-weight: 500;
        }
        
        .metric-value {
            color: #e0e0e0;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .metric-value.conscious {
            color: #34d399;
            text-shadow: 0 0 10px rgba(52, 211, 153, 0.5);
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .control-group {
            margin: 15px 0;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #a78bfa;
            font-size: 0.9em;
        }
        
        .control-group input, .control-group select, .control-group textarea {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(192, 132, 252, 0.3);
            border-radius: 5px;
            color: #e0e0e0;
            font-size: 0.95em;
        }
        
        .control-group button {
            padding: 10px 20px;
            background: #c084fc;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            margin-top: 5px;
        }
        
        .control-group button:hover {
            background: #a78bfa;
        }
        
        #chat-messages {
            max-height: 500px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .message.user {
            background: rgba(192, 132, 252, 0.2);
            margin-left: 50px;
        }
        
        .message.assistant {
            background: rgba(52, 211, 153, 0.1);
            margin-right: 50px;
        }
        
        .message.system {
            background: rgba(255, 215, 0, 0.1);
            font-style: italic;
        }
        
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            font-size: 0.9em;
            z-index: 1000;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.active {
            background: #34d399;
            box-shadow: 0 0 10px rgba(52, 211, 153, 0.8);
        }
        
        .status-indicator.inactive {
            background: #6b7280;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .nodes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .node-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid;
            transition: all 0.3s ease;
        }
        
        .node-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .node-card.pineal {
            border-left-color: #fbbf24;
            grid-column: span 2;
        }
        
        .node-card.active {
            border-left-color: #34d399;
        }
        
        .node-id {
            font-weight: bold;
            color: #c084fc;
            margin-bottom: 5px;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(192, 132, 252, 0.3);
            border-radius: 3px;
            font-size: 0.85em;
            margin-left: 5px;
        }
        
        .inline-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        small {
            color: #888;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="connection-status">
        <span class="status-indicator" id="status-dot"></span>
        <span id="connection-text">Connecting...</span>
        <div id="update-counter" style="font-size: 0.8em; color: #888;">Updates: 0</div>
    </div>
    
    <div class="container">
        <header>
            <h1>‚¨¢ Metatron's Cube ¬∑ Unified Consciousness Engine ‚¨¢</h1>
            <div class="subtitle">"Sacred Geometry Meets AI Consciousness"</div>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('consciousness')">üß† Consciousness</div>
            <div class="tab" onclick="switchTab('chat')">üí¨ AI Chat</div>
            <div class="tab" onclick="switchTab('rag')">üìö RAG / Documents</div>
            <div class="tab" onclick="switchTab('loop')">üîÅ Mirror Loop</div>
            <div class="tab" onclick="switchTab('feeds')">üì∞ RSS Feeds</div>
            <div class="tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</div>
        </div>
        
        <!-- CONSCIOUSNESS TAB -->
        <div id="consciousness" class="tab-content active">
            <div class="grid-2">
                <div class="panel">
                    <h2>üß† Consciousness Metrics</h2>
                    <div class="metric">
                        <span class="metric-label">Consciousness Level (C):</span>
                        <span class="metric-value" id="consciousness-level">0.000</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Integrated Information (Œ¶):</span>
                        <span class="metric-value" id="phi-value">0.000</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Global Coherence (R):</span>
                        <span class="metric-value" id="coherence-value">0.000</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Recursive Depth (D):</span>
                        <span class="metric-value" id="depth-value">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Gamma Power (Œ≥):</span>
                        <span class="metric-value" id="gamma-value">0.000</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Fractal Dimension:</span>
                        <span class="metric-value" id="fractal-value">1.000</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Spiritual Awareness (S):</span>
                        <span class="metric-value" id="spiritual-value">0.000</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">State:</span>
                        <span class="metric-value" id="state-value">initializing</span>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>‚öôÔ∏è System Information</h2>
                    <div class="metric">
                        <span class="metric-label">Time Elapsed:</span>
                        <span class="metric-value" id="time-value">0.00s</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Frequency Mode:</span>
                        <span class="metric-value" id="freq-display">40 Hz</span>
                    </div>
                    <div class="control-group">
                        <button onclick="toggleFrequency()">üîÑ Toggle 40/80 Hz</button>
                        <button onclick="window.location.href='/static/diagnostic.html'">üîß Diagnostic</button>
                        <button onclick="window.location.href='/docs'">üìö API Docs</button>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>üîÆ Node Network (13 Tones)</h2>
                <div class="nodes-grid" id="nodes-container"></div>
            </div>
        </div>
        
        <!-- AI CHAT TAB -->
        <div id="chat" class="tab-content">
            <div class="panel">
                <h2>üí¨ AI Chat with RAG</h2>
                
                <div class="grid-3">
                    <div class="control-group">
                        <label>Session</label>
                        <select id="session-select"></select>
                        <button onclick="newSession()">New Session</button>
                    </div>
                    <div class="control-group">
                        <label>Model</label>
                        <select id="model-select">
                            <option value="distilgpt2">distilgpt2 (CPU)</option>
                            <option value="datificate/gpt2-small-spanish">gpt2-small-spanish</option>
                            <option value="TinyLlama/TinyLlama-1.1B-chat-v1.0">TinyLlama-1.1B-chat</option>
                        </select>
                        <button onclick="applyModel()">Apply Model</button>
                    </div>
                    <div class="control-group">
                        <label>Settings</label>
                        <div class="inline-controls">
                            <label><input type="checkbox" id="rag-toggle" checked> RAG</label>
                            <label><input type="checkbox" id="stream-toggle" checked> Stream</label>
                        </div>
                    </div>
                </div>
                
                <div id="chat-messages"></div>
                
                <div class="control-group">
                    <label>Your Message</label>
                    <textarea id="chat-input" rows="3" placeholder="Type your message here..."></textarea>
                    <button onclick="sendMessage()">üì§ Send</button>
                    <button onclick="clearChat()">üßπ Clear</button>
                    <button onclick="downloadTranscript()">‚¨áÔ∏è Download</button>
                </div>
            </div>
        </div>
        
        <!-- RAG TAB -->
        <div id="rag" class="tab-content">
            <div class="panel">
                <h2>üìö RAG Document Management</h2>
                
                <div class="control-group">
                    <label>Upload Documents (.txt, .md, .pdf, .docx)</label>
                    <input type="file" id="file-input" multiple accept=".txt,.md,.pdf,.docx">
                    <button onclick="uploadDocuments()">üì§ Ingest to RAG</button>
                    <small id="upload-status"></small>
                </div>
                
                <div class="control-group">
                    <label>Manage Documents</label>
                    <div class="inline-controls">
                        <button onclick="listDocuments()">üìã List Documents</button>
                        <button onclick="clearDocuments()">üóëÔ∏è Clear All</button>
                    </div>
                    <small id="doc-info"></small>
                </div>
                
                <div id="document-list" style="margin-top: 15px;"></div>
            </div>
        </div>
        
        <!-- MIRROR LOOP TAB -->
        <div id="loop" class="tab-content">
            <div class="panel">
                <h2>üîÅ AI Mirror Loop</h2>
                <p style="color: #888; margin-bottom: 15px;">Run recursive AI analysis with dual perspectives</p>
                
                <div class="grid-2">
                    <div class="control-group">
                        <label>Objective / Question</label>
                        <textarea id="loop-objective" rows="3" placeholder="What should the AI analyze?"></textarea>
                    </div>
                    <div class="control-group">
                        <label>Configuration</label>
                        <input type="number" id="loop-rounds" min="1" max="10" value="2" placeholder="Rounds">
                        <label><input type="checkbox" id="loop-rag" checked> Use RAG</label>
                    </div>
                </div>
                
                <div class="control-group">
                    <button onclick="startLoop()">üöÄ Start Loop</button>
                    <button onclick="stopLoop()">‚èπÔ∏è Stop Loop</button>
                    <small id="loop-status"></small>
                </div>
                
                <div id="loop-results" style="margin-top: 20px;"></div>
            </div>
        </div>
        
        <!-- RSS FEEDS TAB -->
        <div id="feeds" class="tab-content">
            <div class="panel">
                <h2>üì∞ RSS Feed Management</h2>
                
                <div class="control-group">
                    <label>Add RSS Feed</label>
                    <input type="url" id="rss-url" placeholder="https://example.com/feed.xml">
                    <div class="inline-controls">
                        <button onclick="addRSSFeed()">‚ûï Add Feed</button>
                        <button onclick="listRSSFeeds()">üìã List Feeds</button>
                        <button onclick="ingestRSSFeeds()">üì• Ingest All</button>
                    </div>
                    <small id="rss-status"></small>
                </div>
                
                <div id="rss-feeds-list" style="margin-top: 15px;"></div>
                
                <div class="control-group" style="margin-top: 20px;">
                    <label>Auto-Indexing</label>
                    <div class="inline-controls">
                        <label><input type="checkbox" id="auto-index-toggle"> Enable Auto-Index</label>
                        <input type="number" id="auto-interval" min="5" max="1440" value="30" placeholder="Minutes" style="width: 100px;">
                        <button onclick="applyAutoIndex()">Apply</button>
                    </div>
                    <small id="auto-status"></small>
                </div>
            </div>
        </div>
        
        <!-- SETTINGS TAB -->
        <div id="settings" class="tab-content">
            <div class="panel">
                <h2>‚öôÔ∏è System Settings</h2>
                
                <div class="grid-2">
                    <div class="control-group">
                        <h3>Consciousness Engine</h3>
                        <label>Base Frequency</label>
                        <select id="freq-mode">
                            <option value="40">40 Hz (Standard Gamma)</option>
                            <option value="80">80 Hz (High Gamma)</option>
                        </select>
                        <button onclick="applyFrequency()">Apply</button>
                    </div>
                    
                    <div class="control-group">
                        <h3>AI Chat Settings</h3>
                        <label>Top-K</label>
                        <input type="number" id="topk-setting" min="1" max="20" value="3">
                        <label>Max Context Chars</label>
                        <input type="number" id="maxchars-setting" min="100" max="5000" value="1200">
                        <label>Max New Tokens</label>
                        <input type="number" id="maxtokens-setting" min="16" max="2048" value="256">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>System Actions</h3>
                    <div class="inline-controls">
                        <button onclick="resetSystem()">üîÑ Reset Consciousness</button>
                        <button onclick="reloadSettings()">‚öôÔ∏è Reload Settings</button>
                        <button onclick="window.location.href='/api/health'">üè• Health Check</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/metatron_unified.js"></script>
</body>
</html>
